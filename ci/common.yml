steps:
- script: |
    node bin.js version
  displayName: Print Flossbank version
- script: |
    set -e

    echo "Setting API key"
    node ci/configure.js

    echo "Setting API host to staging"
    patch -u src/constants.js -i ci/constants.patch
    npm run build

    echo "Testing install with ads"
    pushd ci/example
    DEBUG=flossbank node ../../bin.js npm install > ../install_log.txt 2>&1
    popd

    echo "Install log:"
    cat ci/install_log.txt

    echo "Validating ads were shown"
    node ci/validateInstall.js
  displayName: Test ads during install